### Сервис назначения ревьюеров для Pull Request’ов

Данный сервисв реализует все условия из [задания](https://github.com/avito-tech/tech-internship/blob/main/Tech%20Internships/Backend/Backend-trainee-assignment-autumn-2025/Backend-trainee-assignment-autumn-2025.md) 

### Инструкция по запуску

1. Необходимо склонировать репозиторий в любое удобно место без кириллицы
```bash
git clone https://github.com/Nikitos-Naston/PR-Rewiewer-Service.git
```

2. После того как репозиторий склонируется, его можно запустить двумя способами

* (РЕКОМЕНДУЕТСЯ) С Помощью Docker

* Локально на компьютере

3. Для запуска с помощью докер в Терминале в директории проекта выполните команду
```bash
docker-compose up
```

Сервис поднимется и станет доступным по адресу http://localhost:8080/

Остановить контейнер можно с помощью **CTRL + C** если вы находитесь в том же терминале и в той же директории

В противном случае вам нужно будет остановить контейнер вручную с помощью Docker Desktop
или узнать ID контейнера который сейчас работает с помощью команды 
```bash
docker ps
```
Вывод  будет выглядеть примерно так:
CONTAINER ID   IMAGE                COMMAND                  CREATED       STATUS                                                         
**249465bd130f**   test_pr_api-app      "./app"                  6 hours ago   Up 6 seconds              
**2a6ddde031d**   postgres:15-alpine   "docker-entrypoint.s…"   6 hours ago   Up 11 seconds (healthy)   

Вам нужны CONTAINER ID

Выполните комаду где вместo CONTAINER_ID_1 и CONTAINER_ID_2 Вставите ID ваших контейнеров
```bash
docker stop CONTAINER_ID_1 CONTAINER_ID_2
```

4. Запуск локально
Запуск локально можно осуществлять при наличии базы данных PostgresSql и описанного .env файлы
в проекте.
Файл .env Должен распологаться в директории **config**
и содержать

DB_HOST = Хост БД , если все происходит на вашем компьютере обычно это localhost
DB_PORT = Порт на котором запустилось БД обычно это 5432
DB_USER = Пользователь БД , по умолчанию это postgres
DB_PASSWORD = Пароль от БД, по умолчанию это postgres
DB_NAME =  Имя созданной вами базы данных 
PORT = Порт на котором будет запускаться сервис, обычно 8080

Сборка проекта осуществляется с помощью **Makefile**

Он содержит такие команды как:

**Start**(РЕКОМЕНДУЕТСЯ для перовго запуска) - Осущетсвляет первичную up миграцию , Собирает проект и запускает его

**fullrestart** - Используйте когда нужно отчистить базу данных полностью и сразу запустить проект(грубо говоря удаляет и создает БД)

**buildrun** - Собирает и запускает сервер, без работы с базами данных

**run** - Запускает собранный сервис

**build** -  Собирает проект

**up** - Запускает Up миграцию (миграция которая создает таблицы)

**down** - Запускает Down миграцию (миграция которая удаляет таблицы)

В терминале в папке проекта запускайте make + выбранная команда как на примере ниже:
make up
make buildrun

Все, проект готов к работе. Можете использовать все описанные методы в openapi, а также дополнительные медоты

**GET /status**
 
Который возваращет **HEALTHY** если сервер работает.

и метод

**GET /stats**

Метод возваращет статистику по таблице в Формате JSON
Общую статистику по количеству открытых и закрых PR и статиситику по каждому пользователю(имя, количество PR где он автор, количетсво назначенных запросов)

Выглядит примерно так
```JSON
{
  "Global_stats": {
    "total_open": 5,
    "total_merged": 12
  },
  "User_stats": [
    {
      "user_name": "alice",
      "created_total": 7,
      "assigned_pending": 3
    },
    {
      "user_name": "bob",
      "created_total": 4,
      "assigned_pending": 1
    }
  ]
}
```
Также было проведено нагрузочное тестирование его результат на картинке, сервер вполне справляется с емкими запросами(по моему мнению)
Получение команды и создание PR с последующем назначением. 

<img width="1353" height="707" alt="load_test_result" src="https://github.com/user-attachments/assets/82b0af0e-1cb6-4453-a6c4-97a0bb54cee0" />


Для удобства тестирования, в папку testing были добавлены 3 JSON структры которые можно загрузить в POSTMAN и протестировать

All_methods.json - предствляет собой все возможные методы и часть ошибок которые можно получить 

api_test.json - коллекция из ряда запросов которые проверяют корректность работы сервиса

load_test.json - коллекция из двух запросов, с помощью него можно формировать нагрузочное тестирование, но перед запуском нужно наполнить таблицу данным, сделать это можно при помощи файла generate.go в папке testing (запускать его следует после запуска сервиса в отдельном терминале комадой **go run testing/generate.go**)



### Вопросы и решения

Один вопрос только появился, может ли неактивный участник создавать PR. 

Было решено что нет и была сделана проверка на IsActive

### Планы и вопросы
Понимаю что планы , это только планы и расписат тут можно много чего.
Но из того что, как мне кажется надо было бы доделать, но из-за моей неопытности, я не совсем понимал надо оно или нет

Это сделать prefix для обращения к api, к примеру api/v1/PRService
это не тяжело вставить , но мое время к сожалению заканчивается 

И второе, это мое доверие к клиенту на той стороне, что он присылет не пустые формы и код не падает в панику
Можно было бы реализовать проверку на входыне параметры, не знаю нужно ли оно или мы уверены в клиенте, но в любом случае спасибо за время

P.S.
Спасибо большое за такой контест, пришлось поломать голову над необычное задачей и пощупать нагрузочное тестирование:)

